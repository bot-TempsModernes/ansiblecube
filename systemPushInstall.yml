---
# SystemPushInstall has to be use in PUSH mode. 
# ex : ansible-playbook -i hosts -l SystemPushInstall -u root systemPushInstall.yml
# The role can be played against any system define in "hosts" file -> [SystemPushInstall]

- hosts: SystemPushInstall

  roles:
  # It will install all the basic package and configuration for the KoomBook/IdeasBox
  - systemInit
  - dnsmasq
  - hostapd
  - iptables
  - nginx
  - uwsgi
  - kalite

  - role: ideascube
    version: "0.4.1-1"
    ideascube_id: "kb_servir_ben"

  # Install all the file to activate the Mook plateform
  # - mongodb
  # - { role: mook, mook_name: bsfcampus }

  # - appinventor
  - software

  # Install and configure a kiwix project 
  - role: kiwix
    kiwixProject: wikipedia
    portProject: 8002
  - role: kiwix
    kiwixProject: wikisource
    portProject: 8003
  - role: kiwix
    kiwixProject: vikidia
    portProject: 8004
  - role: kiwix
    kiwixProject: cpassorcier
    portProject: 8005
  - role: kiwix
    kiwixProject: ubuntudoc
    portProject: 8006
  - role: kiwix
    kiwixProject: gutenberg
    portProject: 8007
  - role: kiwix
    kiwixProject: ted
    portProject: 8010

  post_tasks:
  # Everything is up-to-date and configured, ready to clone the SD card, 
  # don't forget to configure the update YALM file It will be call at the next startup
  - name: All done ! You can clone your SD card. Update your initPullUpdate.yml to the right project
    file: path=/etc/udev/rules.d/70-persistent-net.rules state=absent
  
  - name: Shutdown now !
    command: /sbin/shutdown -h now