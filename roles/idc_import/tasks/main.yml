---
- include_vars: group_vars/{{ ansible_architecture }}.yml

- name: Open all outgoing connection to allow NFS, dirty but working ! 
  command: iptables -t filter -I OUTPUT -j ACCEPT

- name: Install nfs-common
  apt: name=nfs-common state=present

- name: Create a working dir for NFS shared
  file: path=/media/synology/ state=directory

- name: Mount shared folder from a NFS Share
  command: mount -t nfs -o proto=tcp,port=2049 {{synology}}:"/volume1/Contenus-Educ/Gestion des contenus/" /media/synology
  ignore_errors: yes
  
- name: Import data 
  shell: ideascube import_medias /media/synology/{{ ansible_local.device_list[generic_project_name].idc_import.content_name }}

- name: Unmount shared folder from a NFS Share
  command: umount /media/synology

- name: Set permission back to the user instead of root after importing the medias
  file: path=/var/ideascube/ owner={{ username }} group={{ username }}  mode=0755 recurse=yes
