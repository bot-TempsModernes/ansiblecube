---
- name: Install Network-Manager
  apt: name=network-manager state=latest
  notify: restart dnsmasq
  tags: 
    - master

- name: Create entry to clone/pull git repository
  copy: src=nm-dispatcher dest=/etc/NetworkManager/dispatcher.d/ansiblePullUpdate
    owner=root group=root mode=0755
  tags: 
    - custom

- name: Add a cron entry to execute ansible-pull
  cron: name="Execute ansible-pull automatically" minute="0" hour="0" day="1" 
    job="/etc/NetworkManager/dispatcher.d/ansiblePullUpdate eth0 up"
  tags: ['custom', 'update']

- name: remove old way of lunching ansible-pull
  file: path=/etc/dhcp/dhclient-exit-hooks.d/ansiblePullUpdate state=absent
  tags: 
    - update

# - name: Remove oneUpdateFile branch if present in ansiblePullUpdate file
#   replace: dest=/etc/NetworkManager/dispatcher.d/ansiblePullUpdate regexp='-C oneUpdateFile' replace='' backup=yes
#   tags: 
#     - update